# Document Scanner

> **💝 SUPPORT THE PROJECT**  
> If you find this package useful, consider supporting its development: **[Donate via PayPal](https://paypal.me/ErosNardi)** ☕
>
> **⚠️ DISCLAIMER - PRIVATE USE ONLY**  
> This package is intended for **private use only** and is provided **without any warranty or guarantee of correct functionality**. The software is developed **100% by AI with human supervision** using advanced code generation techniques.  
> 
> **No Support Provided**: This is an experimental project - use at your own risk. The authors assume no responsibility for any issues, data loss, or damages that may occur from using this software.

A Flutter package for scanning documents, receipts, and manuals with automatic cropping, filtering, and PDF generation. **Now with Multi-Page Support!**

## Features

- **🔸 Single & Multi-Page Scanning**: Scan individual pages or combine multiple pages into one document
- **📸 Document Scanning**: Camera and gallery support for document capture
- **🎨 Advanced Image Processing**: Automatic cropping, grayscale conversion, contrast enhancement
- **✨ Image Editing**: Post-capture editing with rotation, color filters, and cropping
- **🔄 True Perspective Correction**: Transform quadrilateral selections into perfect rectangles
- **📐 Document Format Support**: A4, Letter, Square formats with proper aspect ratios
- **📄 Clean PDF Generation**: Minimal PDF output without headers/footers (multi-page shows page numbers only)
- **🖼️ Optimized Color Filters**: Enhanced and B&W filters preserve faded text visibility
- **📱 QR Code Scanning**: Automatic manual download from QR codes
- **📋 Multiple Document Types**: Receipts, manuals, documents with specific processing
- **💾 External Storage**: Safe storage outside app directory with descriptive naming
- **⚙️ Customizable Processing**: Configurable image processing options
- **🔄 Page Management**: Add, remove, reorder, and preview pages in multi-page documents
- **💾 Flexible Output**: Choose between PDF-only (default) or PDF + image file

## Installation

Add this package to your Flutter project:

```yaml
dependencies:
  document_scanner:
    path: packages/document_scanner
```

## Usage

### Configuration (Required)

Before using any scanning functionality, you must configure the storage settings:

```dart
import 'package:document_scanner/document_scanner.dart';

// Configure storage (call this once at app startup)
DocumentScannerService().configureStorage(
  appName: 'MyApp',                    // Your app name for directory creation
  customStorageDirectory: '/custom/path', // Optional: custom base path
  pdfBrandingText: 'Generated by MyApp',  // Optional: custom PDF footer text
);
```

### Single Page Scanning

```dart
import 'package:document_scanner/document_scanner.dart';

// Scan a single receipt
final result = await DocumentScannerService().scanDocument(
  documentType: DocumentType.receipt,
  processingOptions: DocumentProcessingOptions.receipt,
  customFilename: 'MyReceipt',
);

if (result.success) {
  print('Document saved: ${result.document?.pdfPath}');
} else {
  print('Error: ${result.error}');
}
```

### Multi-Page Scanning

```dart
// Use the multi-page scanner widget
MultiPageScannerWidget(
  documentType: DocumentType.manual,
  customFilename: 'ProductManual',
  onScanComplete: (result) {
    if (result.success) {
      print('Multi-page document created: ${result.document?.pdfPath}');
      print('Pages scanned: ${result.document?.pages.length}');
    }
  },
)
```

### Multi-Page Workflow

1. **Start Scanning**: Scan the first page
2. **Add More Pages**: Continue scanning additional pages
3. **Preview & Manage**: View thumbnails, preview pages, reorder, or delete pages
4. **Finalize**: Combine all pages into a single optimized PDF

### Using the Single Page UI Widget

```dart
DocumentScannerWidget(
  documentType: DocumentType.receipt,
  showQROption: true,
  onScanComplete: (result) {
    if (result.success) {
      // Handle successful scan
    } else {
      // Handle error
    }
  },
)
```

### QR Code Scanning for Manuals

```dart
// Scan QR code
final qrResult = await DocumentScannerService().scanQRCode();

if (qrResult.success && qrResult.contentType == QRContentType.manualLink) {
  // Download manual from QR code URL
  final downloadResult = await DocumentScannerService().downloadManualFromUrl(
    url: qrResult.qrData,
    customFilename: 'ProductManual',
  );
}
```

### Custom Processing Options

```dart
final customOptions = DocumentProcessingOptions(
  convertToGrayscale: true,
  enhanceContrast: true,
  autoCorrectPerspective: true,
  compressionQuality: 0.9,
  generatePdf: true,
  saveImageFile: false, // Default: PDF only, set true for PDF + image
);

final result = await DocumentScannerService().scanDocument(
  documentType: DocumentType.document,
  processingOptions: customOptions,
);
```

### Output File Control

By default, the package saves only the final PDF file for optimal storage usage:

```dart
// Default behavior - PDF only (recommended)
final options = DocumentProcessingOptions(
  generatePdf: true,
  saveImageFile: false, // Default
);

// Optional - Save both PDF and processed image
final optionsWithImage = DocumentProcessingOptions(
  generatePdf: true,
  saveImageFile: true, // Saves both PDF and .jpg
);
```

## Image Editing Features

The package now includes a comprehensive image editing screen that **automatically appears after every image capture**, allowing users to perfect their scanned documents in real-time:

### Editing Options

#### Rotation
- **90° Clockwise**: Rotate image right with dedicated button
- **90° Counterclockwise**: Rotate image left with dedicated button
- **Multiple rotations**: Apply multiple 90° rotations as needed

#### Color Filters (Optimized for Document Scanning)
- **Original**: Keep original colors (default)
- **Enhanced**: Gentle contrast boost that preserves faded text visibility
- **B&W**: Document-optimized grayscale with moderate contrast for readability

#### Cropping with Perspective Correction
- **Auto-detection**: Automatically detect document boundaries
- **Interactive overlay**: Visual crop boundaries with corner handles
- **Manual adjustment**: Fine-tune crop area as needed
- **True perspective correction**: Transform quadrilateral selection into perfect rectangle
- **Document format support**: Choose A4, Letter, Square, or Auto aspect ratios
- **Orientation-aware**: Automatically handles portrait/landscape after rotation

### Automatic Image Editor Integration

The image editor is now **automatically integrated** into both single-page and multi-page workflows:

#### Single-Page Workflow:
1. **Capture** image with camera or import from gallery
2. **Editor opens automatically** with the captured image
3. **User edits** (rotate, filter, crop) or can skip editing
4. **Finalizes** with PDF generation and external storage

#### Multi-Page Workflow:
1. **Scan first page** → Editor opens automatically
2. **Add more pages** → Editor opens for each new page
3. **Manage pages** → Preview, reorder, delete as needed
4. **Finalize document** → All pages combined into single PDF

#### Manual Integration (Advanced):
If you need to show the editor manually in custom workflows:

```dart
import 'package:document_scanner/document_scanner.dart';

// Manual editor integration
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => ImageEditingWidget(
      imageData: capturedImageData,
      onImageEdited: (editedImageData) {
        // Handle the edited image
        print('Image edited successfully');
        Navigator.pop(context);
      },
      onCancel: () {
        // Handle cancel
        Navigator.pop(context);
      },
    ),
  ),
);
```

### Image Editing Options Class

```dart
// Configure editing options programmatically
final editingOptions = ImageEditingOptions(
  rotationDegrees: 90,              // 0, 90, 180, 270
  colorFilter: ColorFilter.highContrast,
  cropCorners: [                    // 4 corner points for cropping
    Offset(50, 50),                 // Top-left
    Offset(350, 60),                // Top-right  
    Offset(340, 450),               // Bottom-right
    Offset(60, 440),                // Bottom-left
  ],
);

// Apply editing options directly
final editedImageData = await ImageProcessor().applyImageEditing(
  originalImageData,
  editingOptions,
);
```

### Auto-detection Features

```dart
// Detect document edges automatically
final corners = await ImageProcessor().detectDocumentEdges(imageData);

// Use detected corners for cropping
final croppedImage = await ImageProcessor().applyImageEditing(
  imageData,
  ImageEditingOptions(cropCorners: corners),
);
```

## Multi-Page Features

### Page Management
- **Add Pages**: Continue scanning additional pages seamlessly
- **Page Thumbnails**: Visual grid view of all scanned pages
- **Page Preview**: Fullscreen preview with zoom and navigation
- **Delete Pages**: Remove unwanted pages from the document
- **Reorder Pages**: Drag and drop to change page order

### Processing Options
- **Individual Processing**: Each page processed with same settings
- **Batch Processing**: Efficient processing of multiple pages
- **Unified PDF**: All pages combined into single optimized PDF
- **Clean Output**: Minimal PDF design with maximum space for content

### PDF Generation Features

The package generates clean, professional PDFs optimized for document scanning:

#### Single-Page PDFs
- **Minimal design**: No headers, footers, or branding
- **Maximum content space**: 5px margins only
- **Centered image**: Proportionally scaled to fit page
- **Clean output**: Focus on document content

#### Multi-Page PDFs
- **Page numbers only**: Discrete page counter (e.g., "2/5") in bottom-right
- **Consistent layout**: Same clean design across all pages
- **No metadata clutter**: No scan dates, app info, or branding

### UI Components
```dart
// Multi-page scanner with full page management
MultiPageScannerWidget(
  documentType: DocumentType.manual,
  processingOptions: DocumentProcessingOptions.manual,
  onScanComplete: (result) {
    // Handle completed multi-page document
  },
)
```

## Document Types

### Receipt Processing
- **Grayscale conversion** for better text readability
- **High contrast** enhancement for faded receipts
- **Automatic cropping** to document boundaries (manual/guided mode)
- **Multi-page support** for long receipts

### Manual Processing
- **Color preservation** for diagrams and illustrations
- **QR code support** for automatic download
- **URL validation** and metadata extraction
- **Multi-page support** for complex instruction manuals
- **Chapter organization** with page management

### Document Processing
- **Balanced processing** for general documents
- **Perspective correction** for angled scans
- **Adaptive processing** based on content type
- **Multi-page support** for contracts, forms, reports

## File Naming Convention

The package uses a flexible, hierarchical naming system:

### Priority Order:
1. **Custom Filename**: If provided via `customFilename` parameter
2. **Product-Based**: `YYYY-MM-DD_Brand_Model_Type.pdf` (when brand/model available)
3. **Timestamp Fallback**: `YYYYMMDD_Type.pdf` (when no product details)

### Examples:
- **With Product Info**: `2025-01-09_Samsung_GalaxyS24_Receipt.pdf`
- **Custom Name**: `MyCustomReceipt_Receipt.pdf`
- **Timestamp Fallback**: `20250109_Receipt.pdf`
- **Multi-Page**: `2025-01-09_LG_Washer_Manual.pdf`

### Metadata Support:
```dart
// Pass product details for intelligent naming
final result = await DocumentScannerService().scanDocument(
  documentType: DocumentType.receipt,
  customFilename: 'CustomName', // Highest priority
  // Or let the service generate from metadata:
  // metadata: {
  //   'productBrand': 'Samsung',
  //   'productModel': 'Galaxy S24',
  //   'purchaseDate': '2025-01-09',
  // }
);
```

## Storage Structure

Documents are stored in configurable external storage for safety:
- **Android**: `/storage/emulated/0/Documents/{AppName}/` (configurable)
- **iOS**: App documents directory or custom path
- **Organization**: Automatic folder creation and file management

### Storage Configuration Options

```dart
// Default configuration (uses 'DocumentScanner' as app name)
DocumentScannerService().configureStorage(
  appName: 'MyApp',
);

// Custom storage path
DocumentScannerService().configureStorage(
  appName: 'MyApp',
  customStorageDirectory: '/storage/emulated/0/MyCustomPath',
);

// Custom PDF branding
DocumentScannerService().configureStorage(
  appName: 'MyApp',
  pdfBrandingText: 'Generated by MyApp v2.0',
);
```

## Multi-Page Session Management

```dart
// Create a multi-page session
final session = MultiPageScanSession(
  sessionId: 'unique_session_id',
  documentType: DocumentType.manual,
  processingOptions: DocumentProcessingOptions.manual,
  startTime: DateTime.now(),
);

// Add pages progressively
session = session.addPage(scannedPage1);
session = session.addPage(scannedPage2);

// Reorder pages
session = session.reorderPages(reorderedPageList);

// Convert to final document
final finalDocument = session.toScannedDocument();
```

## Permissions

The package requires the following permissions:

### Android
```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.INTERNET" />
```

### iOS
```xml
<key>NSCameraUsageDescription</key>
<string>This app needs camera access to scan documents</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>This app needs photo library access to import documents</string>
```

## Architecture

```
DocumentScannerService
├── ImageProcessor (cropping, filtering, enhancement)
├── PdfGenerator (single & multi-page PDF creation)
├── QRScannerService (QR scanning and manual download)
├── DocumentScannerWidget (single page UI)
└── MultiPageScannerWidget (multi-page UI with management)
```

## API Reference

### DocumentScannerService
- `configureStorage()` - Configure storage paths and branding (required)
- `scanDocument()` - Scan single page with camera
- `importDocument()` - Import single page from gallery
- `scanQRCode()` - Scan QR code for manual download
- `downloadManualFromUrl()` - Download manual from URL

### Multi-Page Classes
- `MultiPageScanSession` - Manages progressive scanning workflow
- `DocumentPage` - Represents individual pages in multi-page documents
- `MultiPageScannerWidget` - Complete UI for multi-page scanning

### Image Editing Classes
- `ImageEditingWidget` - Complete UI for post-capture image editing
- `ImageEditingOptions` - Configuration for rotation, filters, and cropping
- `ColorFilter` - Enum for color filter options (none, highContrast, blackAndWhite)
- `ImageProcessor.applyImageEditing()` - Apply editing options to image data
- `ImageProcessor.detectDocumentEdges()` - Auto-detect document boundaries

### DocumentProcessingOptions
- `convertToGrayscale` - Convert to grayscale
- `enhanceContrast` - Enhance contrast
- `autoCorrectPerspective` - Auto-correct perspective
- `compressionQuality` - JPEG compression quality
- `generatePdf` - Generate PDF output

### DocumentType
- `receipt` - Receipt processing (supports multi-page)
- `manual` - Manual processing (optimized for multi-page)
- `document` - General document processing
- `other` - Custom processing

## Multi-Page Best Practices

1. **Page Order**: Scan pages in the desired final order when possible
2. **Consistent Lighting**: Maintain consistent lighting across all pages
3. **Quality Check**: Preview each page before adding the next
4. **Page Limits**: Consider device memory when scanning many pages
5. **Error Handling**: Always handle scan failures gracefully

## Performance Considerations

- **Memory Management**: Pages are processed individually to minimize memory usage
- **Background Processing**: Image processing happens off the main thread
- **Progressive Loading**: Thumbnail generation is optimized for performance
- **Storage Optimization**: PDF compression reduces file sizes significantly

## Example App

The package includes an example app demonstrating all features:

```bash
cd example
flutter run
```

## Contributing

This package is designed to be reusable across multiple projects. When contributing:

1. Keep the API framework-agnostic
2. Add comprehensive tests for both single and multi-page functionality
3. Update documentation with examples
4. Follow Flutter package conventions
5. Test multi-page workflows thoroughly

## License

This package is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

Copyright (c) 2025 Eros Nardi

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

## Disclaimer

This package was developed using **vibe-coding supervised by AI** methodology. While thoroughly designed and tested, the authors make no warranties regarding the software's performance, reliability, or suitability for any particular purpose.

**⚠️ Use at your own risk**: The developers are not responsible for any data loss, device damage, or other issues that may arise from using this package. Users are responsible for testing the software in their own environment and ensuring it meets their requirements.

**🔒 Privacy Notice**: This package processes documents locally on your device. No data is transmitted to external servers unless explicitly configured by the user (e.g., cloud backup features).

---

### Multi-Page Scanning Demo

**Workflow Example:**
1. Tap "Scan First Page" → Camera opens
2. Scan page → Auto-processed and added to session
3. Tap "Add Page" → Scan additional pages
4. View thumbnail grid → Preview, reorder, or delete pages
5. Tap "Done" → All pages combined into single PDF

This multi-page capability makes the package perfect for scanning complex documents like instruction manuals, contracts, reports, and multi-page receipts.